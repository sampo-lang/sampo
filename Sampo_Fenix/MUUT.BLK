                                                    HPU                                                                                                                                             M     M    U     U    U     U  TTTTTTT                          MM   MM    U     U    U     U     T                             M M M M    U     U    U     U     T                             M  M  M    U     U    U     U     T                             M     M    U     U    U     U     T                             M     M    U     U    U     U     T                             M     M     UUUUU      UUUUU      T                                                                                                                                                                                                                                                                                                                                                                                                                         \ TEST                                                                                                                          2    LOAD CR .( OLETUSVIERITYKSET)                                                                                              3 19 THRU CR .( FP -PAKKAUS )                                                                                                   CR .( MUUT LADATTU )                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            \ Oletusvieritykset                                             VARIABLE NYTRUUTU       DEFER PRINTTUO                          : DEBUG 6 VIERIT ! DEBUG ;                                      : ASKELLA DEBUG ;                                               : SEIS UNBUG ;                                                  : KORUUSI 1 VIERIT ! UUSI ;                                     : TMOODI 22 VIERIT !      ;                                     : KORJAA 1 grtapa ! scr @ KORUUSI EDIT kursori_pois ;           : KATSO                                                           TMOODI VIEW ;                                                                                                                 : VPO023 DROP CR ." VIERITYKSEN PIT[[ OLLA V[LILL{ 1..22 " ;    : VIERITYS                                                        FIX DROP DUP 0> IF DUP 23 < IF VIERIT ! ELSE VPO023 THEN                        ELSE VPO023 THEN                              ;                                                               \ FP-fort:lla                                                   \ Rakenne SEEEEEEE MMMMMMMM   MMMMMMMM MMMMMMMM                                                                                 VARIABLE  EXP   VARIABLE  EXP1  VARIABLE  EXP2                  2VARIABLE MAN   2VARIABLE MAN1  2VARIABLE MAN2                  2VARIABLE MAN3  2VARIABLE MAN4  VARIABLE  FSIGN HEX                                                                             : F>S                           \ --- , ---                       MAN 2@ 80FF AND                                                 EXP @ 40 + 7F AND 100 * +                                     ;                                                                                                                                                                                                                                                                                                                                                                                               \ FP-fort:lla                                                                                                                   : FPUT                          \ ADDR , ---                      F>S ROT 2!                                                    ;                                                               : S>F                           \ NUM , ---                       2DUP OR IF                                                                 DUP 7F00 AND 4000 - 100 / EXP !                                 80FF AND DUP 0 <                                                IF FF00 OR THEN                                                 MAN 2!                                                       ELSE                                                               0 EXP ! MAN 2!                                               THEN ;                                                : FGET                                                            2@ S>F ; DECIMAL        \ ADDR , ---      E                   \ MOVET                                       >17.2.86-HPU      : >F1                                                             MAN 2@ MAN1 2! EXP @ EXP1 ! ;                                 : >F2                                                             MAN 2@ MAN2 2! EXP @ EXP2 ! ;                                 : F1>                                                             MAN1 2@ MAN 2! EXP1 @ EXP ! ;                                 : F2>                                                             MAN2 2@ MAN 2! EXP2 @ EXP ! ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 \ Normalisointi                               >17.2.86-HPU      HEX                                                             : FDOWN                                                           BEGIN DUP 0FF > WHILE D2/ 1 EXP +! REPEAT ;                   : FUP                                                             BEGIN DUP 7F <= WHILE 2DUP D+ -1 EXP +! REPEAT ;                                                                              : FNORM                                                           0 FSIGN ! MAN 2@ 2DUP OR 0= IF 0 EXP ! 2DROP ELSE                 DUP 0 < IF DNEGATE -1 FSIGN ! THEN                              DUP 0FF > IF FDOWN                                                ELSE DUP 7F <= IF FUP                                           THEN  THEN  FSIGN @ 0< IF DNEGATE THEN                      MAN 2! THEN                                                   ; DECIMAL                                                                                                                       \ Konversiot                                                                                                                    : DTOF                                  \  DP , ---               MAN 2! 24 EXP ! FNORM  ;                                                                                                      : FOUP                                                            BEGIN EXP @ 24 < WHILE D2/ 1 EXP +! REPEAT ;                  : FDOU                                                            BEGIN EXP @ 24 > WHILE 2DUP D+ -1 EXP +! REPEAT ;                                                                             : FTOD MAN 2@                            \ --- , DP               EXP @ 24 < IF FOUP ELSE EXP @ 24 > IF FDOU THEN  THEN         ;                                                                                                                                                                                                                                                               \ Konversiot                                                    2VARIABLE F.1                                                   HEX 0CC MAN ! 0CCCD MAN 2 + ! DECIMAL -3 EXP ! F.1 FPUT                                                                         2VARIABLE F10 10.      DTOF F10 FPUT                                                                                            : DOSAR                                                           0 ?DO D2/ LOOP ;                                                                                                              : FALIGN                                \ M1 M2 E1 E2 F           DUP 0<                                                          IF   NEGATE MAN1 2@ ROT                                              DOSAR MAN1 2! EXP2 @ EXP !                                 ELSE MAN2 2@ ROT DOSAR                                               MAN2 2! EXP1 @ EXP !                                       THEN ;                                                        \ Yhteenlaskun avut                                                                                                             : FADD0                                                           EXP1 @ EXP2 @ - DUP 24 >            \ E1 >> E2                  IF  DROP EXP1 @ EXP !                                               MAN1 2@ MAN 2!                                              ELSE DUP -24 <                                                       IF   DROP EXP2 @ EXP !                                               MAN2 2@ MAN 2!      \ E2 >> E1                             ELSE ?DUP                                                            IF FALIGN THEN                                                  MAN1 2@ MAN2 2@                                                 D+ MAN 2! FNORM                                            THEN                                                       THEN                                                          ;                                                               \ Kertolasku (se helpompi)                    19.2.86-HPUU      HEX                                                             : FMUL0                                                           0.0 MAN 2! 0 FSIGN !                                            MAN1 @ 0< IF -1 FSIGN +! MAN1 2@ DNEGATE MAN1 2! THEN           MAN2 @ 0< IF  1 FSIGN +! MAN2 2@ DNEGATE MAN2 2! THEN           MAN1 2 + @ MAN2 2 + @ UM* MAN 2 + ! DROP                        MAN1 @ MAN2 2 + @ UM* MAN 2@ D+ MAN 2!                          MAN1 2 + @ MAN2 @ UM* MAN 2@ D+ MAN 2!                          MAN1 @ MAN2 @ UM* DROP 0 SWAP                                   MAN 2@ D+ D2/ 7FFF AND                                          FSIGN @ IF DNEGATE THEN MAN 2!                                  EXP1 @ EXP2 @ + 7 - EXP !                                       FNORM  ; DECIMAL                                              : FMUL                          \ ADDR ,---                       >F2 FGET >F1 FMUL0 ;                                          \ Jako, v{hennyskeinolla, kaikki posit.       19.2.86-HPUU      \ F1 on jaettava(=j{{nn|s) F2 on jakaja FA tulos F3 mask                                                                        HEX                                                             : FDIV1                                                           0 100 MAN3 2! 0 0 MAN 2!                                        18 0 DO MAN1 2@ MAN2 2@ D- MAN1 2! MAN1 @ 0< IF                                 MAN1 2@ MAN2 2@ D+ MAN1 2!                              ELSE                                                                    MAN  2@ MAN3 2@ D+ MAN  2!                              THEN                                                            MAN3 2@ D2/ MAN3 2! MAN2 2@ D2/ MAN2 2!                 LOOP                                                            EXP1 @ EXP2 @ - EXP !                                         ;                                                               DECIMAL                                                         \ Jaon valmistelu                             19.2.86-HPUU                                                                      : FDIV0                                                           0 FSIGN !                                                       MAN1 @ 0< IF -1 FSIGN +! MAN1 2@ DNEGATE MAN1 2! THEN           MAN  @ 0< IF  1 FSIGN +! MAN2 2@ DNEGATE MAN2 2! THEN           FDIV1                                                           MAN 2@ FSIGN @ IF DNEGATE THEN                                  MAN 2!                                                          FNORM                                                         ;                                                                                                                               : FDIV                  \ ADDR , ---                              >F1 FGET >F2 FDIV0 ;                                          : FADD                                                            >F1 FGET >F2 FADD0 ;                                          \ V{hennyslasku                               20.2.86-HPUU                                                                      : FSUB0                                                           MAN2 2@ DNEGATE MAN2 2!                                         FADD0                                                         ;                                                               : FSUB                          \ ADDR , ---                      >F1 FGET >F2 FSUB0                                            ;                                                               : FNEGATE                                                         MAN 2@ DNEGATE MAN 2!                                         ;                                                               : FINT                                                            EXP @ 24 < IF FTOD DTOF THEN                                  ;                                                                                                                               \ Tulostus, fixed-point -alue                 3.3.86-HPUPU      VARIABLE DES    VARIABLE PONT                                                                                                   : MIDDLE                                                          EXP @ 23 > IF FTOD  (D.) LTYPE                                  ELSE                                                              7 EXP @ DUP + 4 + 7 / - DES !                                   >F1 FTOD 2DUP (D.) LTYPE                                        DTOF >F2 FSUB0 >F1 MAN @ MAN 2+ @ OR IF ASCII , LEMIT               DES @ 0 DO                                                          F10 FGET >F2                                                    FMUL0 >F1 FTOD 2DUP (D.) LTYPE                                  DTOF >F2 FSUB0 >F1                                              MAN @ MAN 2+ @ OR 0= IF LEAVE THEN LOOP               THEN THEN                                                     ;                                                               \ Tulostus, ellei FP, skaalataan              3.3.86-HPUPU      : .F                                                              0 PONT ! MAN 2@ DUP 0< IF DNEGATE ASCII - LEMIT THEN            MAN 2! >F1                                                      EXP @ DUP 31 > IF                                                   DROP F.1 FGET >F2 F1>                                           BEGIN EXP @  3 > WHILE FMUL0 1 PONT +! >F1 REPEAT           ELSE                                                                -3 < IF                                                              F10 FGET >F2 F1>                                                BEGIN EXP @ 0 < WHILE FMUL0 -1 PONT +! >F1 REPEAT               THEN                                                   THEN MIDDLE                                                     PONT @ ?DUP IF ASCII E LEMIT (.) LTYPE THEN                     32 LEMIT                                                      ;                                                               \ Muuttaa DP-luvun FP:ksi DPL:n avulla        >24.2.86-HPU                                                                      : FINP                                                            DTOF >F1 F.1 FGET >F2 F1>                                       DPL @ 0 ?DO                                                         FMUL0 >F1 LOOP                                            ;                                                               : FPOT0                                                           F2> FTOD DUP 0<                                                 IF                                                                ." EI VOI OTTAA - POTENSSIA "                                 ELSE                                                                 DROP F1> >F2 1 ?DO                                              FMUL0 >F1 LOOP                                             THEN ;                                                        : FPOT >F1 FGET >F2 FPOT0 ;                                     \ Muuttaa tuplaentryn dp-luvuksi                                : (FIX) RECURSIVE             \ D tai F                           DUP JOS  0 NIIN          LOPPUUN                                        -1 NIIN          LOPPUUN                                         1 NIIN 2DROP 0. LOPPUUN                                         2 NIIN 2DROP 0. LOPPUUN                                         3 NIIN 2DROP 0. LOPPUUN                                         4 NIIN 2DROP 0. LOPPUUN                                         7 NIIN DROP NYTRUUTU @ SWAP PRINTTUO (FIX) LOPPUUN              ELLEI S>F FTOD  LOPPU                                ;                                                               : INT                                                             FIX ;                                                         : (2FIX)                        \ D t F D t F , D D               FIX DROP -ROT FIX DROP SWAP ;                                 ' (FIX) IS FIX  ' (2FIX) IS 2FIX                                \                                             >6.3.86-HPU                                                                       VARIABLE SIEMEN                                                                                                                 : SATTUMA                                                         FIX DROP                                                        SIEMEN @ 256 < IF RP@ SIEMEN +! THEN                            SIEMEN @ DUP UM*                                                256 MU/MOD DROP SIEMEN ! DROP                                   SIEMEN @ ABS 32767 */ 0                                       ;                                                                                                                                                                                                                                                                                                                                                                                               \ Trigonometriaa                                                                                                                : SIN                   \ ASTEET , FP-SIN                         == FIX DROP 360 MOD                                             SIN S>D                                                         DTOF >F1 32677 0 DTOF >F2 FDIV0 F>S                           ;                                                                                                                               : COS                                                             == FIX DROP 360 MOD                                             COS S>D                                                         DTOF >F1 32677 0 DTOF >F2 FDIV0 F>S                           ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               