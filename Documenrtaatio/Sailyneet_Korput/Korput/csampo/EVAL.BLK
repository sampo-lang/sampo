24.4.86                                                                                                                                                                                              EEEEE  V     V     A     L                                      E      V     V    A A    L                                      E       V   V    A   A   L                                      EEEE    V   V    AAAAA   L                                      E        V V     A   A   L                                      E        V V     A   A   L                                      EEEEE     V      A   A   LLLLLLL                                                                                                                                                                                                                                                                                                                                                                                                                           \ Infix -aritmetiikka                                                                                                           DEFER ..                                                                                                                        : PVL  CR  ." PINOSSA VIALLINEN LAUSEKE " CR ;                                                                                  CR .( INFIX ALKAA )                                                                                                             2 28 THRU                                                                                                                       CR .( INFIX OK. )                                                                                                                                                                                                                                                                                                                                                                               \ Aritmetiikka INFIX-notaatio                                    8 3 2CONSTANT  OOR     VARIABLE NYTRUUTU                       16 3 2CONSTANT AAND                                                                                                                                                                             40 3 2CONSTANT PLUS                                             48 3 2CONSTANT  MUL 49 3 2CONSTANT   DIV 50 3 2CONSTANT MMOD    64 3 2CONSTANT  POT                                                                                                             : ARITM?                                                           DUP JOS 4 NIIN 0 LOPPUUN                                                5 NIIN 0 LOPPUUN                                                6 NIIN 0 LOPPUUN                                                 ELLEI 1 LOPPU    ;                                                                                                                                                                  \ Aritmetiikka INFIX-notaatio                                                                                                   : NNOT                      \ PSEUDO-DYADINEN                     0 0 24 3                                                      ;                                                               : MINUS                 \ JOKO UNARY TAI BINARY                   SP0 @ SP@ - 2 -                                                 IF DUP -3 =                                                        IF 0 0 72 3 ELSE 41 3 THEN                                   ELSE 0 0 72 3 THEN                                            ;                                                               : (=)                   \ Teksti vai aritmeettinen                ARITM? IF    37 3                                                      ELSE  42 3 THEN ;                                                                                                                                                                                                                                      : GT                                                              ARITM? IF 34 3 ELSE 43 3 THEN ;                                                                                               : LT                                                              ARITM? IF 32 3 ELSE 47 3 THEN ;                                                                                               : LE                                                              ARITM? IF 33 3 ELSE 45 3 THEN ;                                                                                               : GE                                                              ARITM? IF 35 3 ELSE 46 3 THEN ;                                                                                               : NE                                                              ARITM? IF 36 3 ELSE 44 3 THEN ;                                                                                               \ Hiukan muokattu SAMPO:a varten                              ap: (NORNUM)                                                        DPL @ -1 <> IF   FINP F>S                       \ Jos desim.                ELSE DUP      IF DTOF F>S THEN      \ Jos iso                   THEN ;                                            ' (NORNUM) IS NORNUM                                            : INTER                         \ -- , --                          BEGIN   ?STACK  DEFINED                                           IF     EXECUTE                                                  ELSE   NUMBER NORNUM                                            THEN   FALSE DONE?                                            UNTIL   ;                                                                                                                    : MUUTTUJA                                                        0 0 2CONSTANT DOES> 2 ;                                       : VAKIO 2CONSTANT ;                                             \ Argumenttien k{sittely                                                                                                        2 VARIABLE ARG1         2VARIABLE ARG2                          : FPAT                                                            ARG1 2@ S>F >F2 ARG2 2@ S>F >F1 ;                             : LOGAT                                                           ARG2 2@ ARG1 2@ ;                                                                                                             HEX                                                             : F<                    \ FP FP , Flag                            S>F >F2 S>F >F1 FSUB0                                           F>S SWAP DROP 8000 AND                                          IF   -1                                                         ELSE  0 THEN                                                  ;                                                               DECIMAL                                                         \ Argumenttien k{sittely                                                                                                                                                                        : STOD                                                            S>D ;                                                                                                                         : LTAA                                                            LOGAT F< STOD ;                                                                                                               : LEAA                                                            LOGAT 2OVER 2OVER D=                                            >R F< R> OR STOD ;                                                                                                                                                                                                                                                                                                            \ RELAATIOT                                                     : GTAA                                                            LOGAT 2SWAP F< STOD ;                                                                                                         : GEAA                                                            LOGAT 2OVER 2OVER D=                                            >R 2SWAP F< R> OR STOD ;                                                                                                      : EQAA                                                            LOGAT D= STOD ;                                                                                                               : NEAA                                                            LOGAT D= NOT STOD ;                                                                                                           : NEGATAA                                                         ARG1 2@ S>F FNEGATE F>S ;                                     \ Aakkosvertailut, EQU JA GT                                    DEFER TUO       DEFER PRINTTUO                                                                                                  : CHARAR                                \ Addr , Addr len         2@ 5 = IF    NYTRUUTU @ SWAP TUO                                       ELSE  STRI POBEG + DUP 1+ SWAP C@ THEN                 ;                                                               : CHAREQ                                                          ARG1 CHARAR ARG2 CHARAR                                         2 PICK = IF   SWAP COMPARE 0= DUP                                        ELSE 2DROP DROP 0 0 THEN                             ;                                                               : CHARGT                                                          ARG1 CHARAR ARG2 CHARAR                                         ROT MIN COMPARE 0 < DUP                                       ;                                                               \ ARITMEETTISET RELAATIOT                                                                                                       : CHARNE                                                          CHAREQ DROP NOT DUP ;                                                                                                         : CHARLE                                                          CHARGT DROP NOT DUP ;                                                                                                         : CHARGE                                                          CHAREQ DROP >R                                                  CHARGT DROP R> OR DUP ;                                                                                                       : CHARLT                                                          CHAREQ DROP NOT >R                                              CHARGT DROP NOT R> AND DUP ;                                                                                                  \ Relaatio yms operaatioita                                     : ORAA                                                            ARG1 2@ NOLLAKO ARG2 2@ NOLLAKO  OR STOD ;                    : ANDAA                                                           ARG1 2@ NOLLAKO ARG2 2@ NOLLAKO AND STOD ;                    : NOTAA                                                           ARG2 2@ NOLLAKO 0= STOD ;                                     : MODAA                         \ HIUKAN VAJAA                    ARG2 2@ S>F FTOD                                                ARG1 2@ S>F FTOD                                                DROP M/MOD  DROP                                                STOD ;                                                        HEX                                                             : FLOAT?                \ NUM , FNUM                              DUP 7F00 AND 0= IF DTOF F>S THEN ;                            DECIMAL                                                         \ Argumentin haku, TEKSTIARG:T (4,5,6) L{P                      DEFER LUVUKSI                                                   : LASKELISTA                                                      0 -3 2SWAP TEE == 2SWAP 2DROP ;                               : OTAARG RECURSIVE      \ ARG , ARVO                              DUP JOS                                                            -2 NIIN DROP 2@ FLOAT?                         LOPPUUN          -1 NIIN DTOF F>S                               LOPPUUN           0 NIIN DTOF F>S                               LOPPUUN           1 NIIN LASKELISTA FLOAT?                      LOPPUUN           2 NIIN DROP 2@ FLOAT?                         LOPPUUN           3 NIIN PVL                                    LOPPUUN           7 NIIN DROP NYTRUUTU @ SWAP PRINTTUO FLOAT?   LOPPUUN       LOPPU ;                                                                                                                                                                                       \ Yhden operaation k[sittely                                    : LASKE OTAARG >R >R DROP >R OTAARG                               ARG2 2! R> R> R> ARG1 2!                                           JOS  8 NIIN ORAA   LOPPUUN  16 NIIN ANDAA  LOPPUUN                  24 NIIN NOTAA  LOPPUUN                                          32 NIIN LTAA   LOPPUUN  33 NIIN LEAA   LOPPUUN                  34 NIIN GTAA   LOPPUUN  35 NIIN GEAA   LOPPUUN                  36 NIIN NEAA   LOPPUUN  37 NIIN EQAA   LOPPUUN         40 NIIN FPAT FADD0 F>S LOPPUUN 41 NIIN FPAT FSUB0 F>S LOPPUUN   42 NIIN CHAREQ LOPPUUN  43 NIIN CHARGT LOPPUUN                  44 NIIN CHARNE LOPPUUN  45 NIIN CHARLE LOPPUUN                  46 NIIN CHARGE LOPPUUN  47 NIIN CHARLT LOPPUUN                  48 NIIN FPAT FMUL0 F>S LOPPUUN 49 NIIN FPAT FDIV0 F>S LOPPUUN   50 NIIN FPAT MODAA     LOPPUUN 64 NIIN FPAT FPOT0 F>S LOPPUUN   72 NIIN NEGATAA        LOPPUUN                                           ELLEI ." TUNTEMATON OPERAATTORI " QUIT LOPPU ;         \ EVAL:n apuja                                                                                                                  : OPRONKO               \ kurkkaa kahden yli                      2OVER 3 =                                                              IF   DROP -1                                                    ELSE DROP 0                                                     THEN                                                   ;                                                                                                                               : OP2>OP1               \ OP1 ARG OP2 , ARG FLAG                  2/ 2/ 2/ 4 PICK 2/ 2/ 2/ >                                    ;                                                               : .SKENTT{                                                        DROP NYTRUUTU @ SWAP TUO TYPE 32 EMIT ;                       : .NKENTT{                                                        DROP NYTRUUTU @ SWAP PRINTTUO .. ;                            \ Itse EVAL, simppeli, vaikka mietitytti      3.3.86-HPUPU      : (==)                                                            0 >R OTAARG           \ Jos pelk{t sulut, niin t{ss{            BEGIN                                                             OPRONKO                                                         IF R@ OP2>OP1                                                       IF R> 3 R> R> LASKE                                             ELSE                                                               >R >R DROP >R THEN                                       ELSE                                                                R@ 0<>                                                          IF R> 3 R> R> LASKE THEN                                    THEN                                                            OPRONKO R@ OR 0=                                              UNTIL R> DROP                                                 ;                                                               \ Apurutiineita                                                 : .OPER    DROP                         \ OPR 3 , ---             JOS  8 NIIN ." TAI " LOPPUUN 16 NIIN ." JA " LOPPUUN                24 NIIN ." EI "  LOPPUUN 72 NIIN ." - "  LOPPUUN                32 NIIN ." < "   LOPPUUN 33 NIIN ." <= " LOPPUUN                34 NIIN ." > "   LOPPUUN 35 NIIN ." >= " LOPPUUN                36 NIIN ." <> "  LOPPUUN 37 NIIN ." == " LOPPUUN                42 NIIN ." =$ "  LOPPUUN 43 NIIN ." >$ " LOPPUUN                44 NIIN ." <>$ " LOPPUUN 45 NIIN ." <=$ " LOPPUUN               46 NIIN ." >=$ " LOPPUUN 47 NIIN ." <$ " LOPPUUN                40 NIIN ." + "   LOPPUUN 41 NIIN ." - "  LOPPUUN                48 NIIN ." * "   LOPPUUN 49 NIIN ." / "  LOPPUUN                50 NIIN ." MOD " LOPPUUN 64 NIIN ." ^ " LOPPUUN                  ELLEI ." Tuntematon operaattori " LOPPU ;                : .JONO DROP DUP 2 - @ DUP 6 * 2 -     \ ADR OF VALUE             NEGATE ROT + BODY> >NAME SWAP . .ID ;                         \ Erilaisia tulostuksia                                                                                                         ' (==) IS ==                                                                                                                    : .MUU                                                             DROP                                                            BODY> >NAME .ID ;                                                                                                            : D..                                                             (D.) LTYPE 32 LEMIT ;                                                                                                         : .FAC                                                            ." FAKTA " DROP 4 ..                                          ;                                                                                                                                                                                               \ J{lkisiivous                                                                                                                  : (..)                                                                 DUP JOS                          \ SAMPO-ALKIO , --            -2 NIIN .JONO             LOPPUUN                               -1 NIIN D..               LOPPUUN                                0 NIIN D..               LOPPUUN                                1 NIIN .$                LOPPUUN                                2 NIIN .MUU              LOPPUUN                                3 NIIN .OPER             LOPPUUN                                4 NIIN .$                LOPPUUN                                5 NIIN .SKENTT{          LOPPUUN                                6 NIIN .FAC              LOPPUUN                                7 NIIN .NKENTT{          LOPPUUN                                ELLEI S>F .F             LOPPU  ;                                                                                        \ Tee                                                           : ((..))                                                          depth 2 >= if (..)                                                         else depth 1 = if drop then                                        ." Pino tyhj{ "                                              then ;                                                                                                             ' ((..)) is ..                                                                                                                  VARIABLE TEEBLK                                                                                                                 : BUF-ENA                                                         BUFF-EMIT ON ;                                                                                                                : BUF-DISA                                                        BUFF-EMIT OFF ;                                               \ Lista puskuriin                                   HPU         HEX                                                             : LIST-TO-BUFFER                \ OFF , ---                       BUF-ENA                                                         7FFF AND                                                        (.LIST)                                                         DROP                                                            BUF-DISA                                                      ; DECIMAL                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       \ Tulkinta                                          HPU         HEX                                                             ONLY FORTH ALSO SAMPO ALSO DOS ALSO                                                                                             : TEE-MA                                                          0FFFE BUFFER                                                    BUPO ! 20 BUF!                                                  LIST-TO-BUFFER                                                  20 BUF! 5C BUF! 53 BUF! 20 BUF! 0 BUF!                          FILE @ >R >IN @ >R BLK @ >R                                     0 >IN ! 0FFFE BLK !                                             0 >UPDATE !                                                     INTERPRET                                                       R> BLK ! R> >IN !                                               R> !FILES                                                     ;                                                               \ Tee                                                                                                                           : (TEE)                                                           1 = IF                                                                DUP 8000 <>                                                     IF TEE-MA                                                       ELSE DROP                                                       THEN                                                          ELSE                                                              PPEL DROP                                                     THEN                                                      ;                                                               DECIMAL                                                                                                                         ' (TEE) IS TEE                                                                                                                  \ Puuttuvia sanoja                            >6.3.86-HPU                                                                       : PPEM                                                            CR ." PINON P[[ EI OLE MUUTTUJA " CR                          ;                                                               : ARVO                          \  ADDR TYPE , DVALUE             ABS 2 = IF   2@                                                         ELSE PPEM                                                       THEN                                                  ;                                                               : LLE                           \  DVALUE ADDR TYPE , ---         ABS 2 = IF   2!                                                         ELSE PPEM                                                       THEN                                                  ;                                                                                                                               \                                                                                                                               : MERKKI 2FIX 1 - SWAP 1 - SWAP         \ N X Y , ---             VIDIO02 2SWAP VIDIO20C                                          2SWAP FIX DROP VIDIO10CHA VIDIO20C ;                                                                                          : TULOSTA                               \ ITEM X Y , ---          2FIX VIDIO02 2SWAP VIDIO20C      \ ITEN X' Y' , ---             2SWAP ..  VIDIO20C ;                                                                                                          : UUSIRIVI                                                        CR ;                                                                                                                                                                                                                                                                                                                          \ JONO                                        >11.3.86-HPU                                                                      : JONO FIX DROP                 \ N , -                           DUP CREATE ,                  \ ( DN , ADD -2                   0 ?DO I 1+ , 0 , 0 , LOOP                                       DOES> -ROT FIX DROP OVER @    \ ADR N MAX                       OVER < IF ." INDEKSI LIIAN SUURI " CR 2DROP                            ELSE DUP 1 < IF   ." INDEKSI LIIAN PIENI " 2DROP CR                         ELSE 6 * 2 - + -2 THEN                              THEN                                                   ;                                                                                                                                                                                                                                                                                                                                                                                               \ Lis{{                                             HPU                                                                         : TUPLAA 2DUP ;                                                                                                                 : VAIHDA 2SWAP ;                                                                                                                : KIERR{ 2ROT ;                                                                                                                 : POISTA 2DROP ;                                                                                                                : YLI    2OVER ;                                                                                                                                                                                                                                                                                                                                                                                \ Lis{{ apuja                                                                                                                   : UNOHDA                                                          FORGET ;                                                                                                                      : see                                                             see ;                                                                                                                         : rstdeb                                                          rp@ 2 + dup . 2@ . . ;                                                                                                        : ' ' ;                                                                                                                         : DUMP                                                            2FIX DUMP ;                                                                                                                   \                                                                                                                               : LOPETA IBM-DARK BYE ;                                                                                                         : \S [COMPILE] \S ; IMMEDIATE                                                                                                   : DROP DROP ;                                                                                                                   : [ [COMPILE] [ ; IMMEDIATE                                                                                                     : ] ] ;                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         